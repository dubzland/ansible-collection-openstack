#jinja2: trim_blocks:True,lstrip_blocks:True
{{ ansible_managed | comment }}
[DEFAULT]
transport_url = rabbit://openstack:{{ openstack_rabbitmq_password }}@{{ _controller_address }}:5672/
auth_strategy = keystone
state_path = /var/lib/neutron
{% if 'controller' in group_names %}
core_plugin = ml2
service_plugins = ovn-router
notify_nova_on_port_status_changes = True
notify_nova_on_port_data_changes = True
external_dns_driver = designate
{%   if openstack_neutron_api_worker_count is defined %}
api_workers = {{ openstack_neutron_api_worker_count }}
{%   endif %}
{% endif %}

[agent]
root_helper = "sudo /usr/bin/neutron-rootwrap /etc/neutron/rootwrap.conf"

{% if 'controller' in group_names %}
[database]
connection = mysql+pymysql://{{ openstack_neutron_db_user }}:{{ openstack_neutron_db_password }}@{{ _mysql_address }}:3306/{{ openstack_neutron_db_name }}

[designate]
url = {{ _controller_http_host }}:9001/v2
region_name = {{ _openstack_region_name }}
auth_type = password
username = {{ openstack_neutron_service_user }}
password = {{ openstack_neutron_service_password }}
project_name = service
user_domain_name = {{ _openstack_domain_name }}
project_domain_name = {{ _openstack_domain_name }}
auth_url = {{ _controller_http_host }}:5000/v3
allow_reverse_dns_lookup = True
ipv4_ptr_zone_prefix_size = 24
ipv6_ptr_zone_prefix_size = 116
{% endif %}

[keystone_authtoken]
www_authenticate_uri = {{ _controller_http_host }}:5000/
auth_url = {{ _controller_http_host }}:5000/
memcached_servers = {{ _controller_address }}:11211
auth_type = password
project_domain_name = {{ _openstack_domain_name }}
user_domain_name = {{ _openstack_domain_name }}
project_name = service
username = {{ openstack_neutron_service_user }}
password = {{ openstack_neutron_service_password }}

{% if 'controller' in group_names %}
[nova]
auth_url = {{ _controller_http_host }}:5000
auth_type = password
project_domain_name = {{ _openstack_domain_name }}
user_domain_name = {{ _openstack_domain_name }}
region_name = {{ _openstack_region_name }}
project_name = service
username = {{ openstack_neutron_nova_service_user }}
password = {{ openstack_neutron_nova_service_password }}
{% endif %}

[oslo_concurrency]
lock_path = $state_path/lock

[oslo_policy]
enforce_new_defaults = true
